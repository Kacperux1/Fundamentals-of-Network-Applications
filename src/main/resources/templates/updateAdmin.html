<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">

<div layout:fragment="content">

    <h2>Edycja Administratora</h2>

    <form id="adminForm">

        <input type="hidden" id="adminId" th:value="${admin.id}"/>

        <label>Login</label>
        <input type="text"
               id="login"
               th:value="${admin.login}"
               maxlength="50"
               required/>

        <label>Email</label>
        <input type="email"
               id="email"
               th:value="${admin.email}"
               maxlength="50"
               required/>

        <br/><br/>

        <button type="submit">Zapisz zmiany</button>
        <a th:href="@{/view/users}">Anuluj</a>

    </form>

    <div id="message"></div>

    <script>
        document.getElementById("adminForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            const id = document.getElementById("adminId").value;

            const data = {
                login: document.getElementById("login").value,
                email: document.getElementById("email").value,
            };

            const messageDiv = document.getElementById("message");
            messageDiv.innerHTML = "";

            try {
                const response = await fetch(`/users/${id}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || "Błąd walidacji");
                }

                alert("Zapisano zmiany Administratora");
                window.location.href = "/view/users";

            } catch (err) {
                messageDiv.innerHTML =
                    "<div class='error'>" + err.message + "</div>";
            }
        });
    </script>

</div>

</html>
