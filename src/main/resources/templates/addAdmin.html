<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">

<div layout:fragment="content">

    <h1>Dodaj administratora</h1>

    <form id="adminForm">

        <label>Login</label>
        <input type="text" id="login" required maxlength="50">

        <label>Email</label>
        <input type="email" id="email" required maxlength="50">

        <label>Aktywny</label>
        <input type="checkbox" id="active" checked>

        <br><br>
        <button type="submit">UtwÃ³rz administratora</button>
    </form>

    <div id="message" style="color:red;"></div>

    <script>
        document.getElementById("adminForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            const data = {
                type: "administrator",   // ðŸ”¥ MUSI PASOWAÄ† do @JsonSubTypes
                login: document.getElementById("login").value,
                email: document.getElementById("email").value,
                active: document.getElementById("active").checked
            };

            const messageDiv = document.getElementById("message");
            messageDiv.innerHTML = "";

            try {
                const response = await fetch("view/users/add", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || "BÅ‚Ä…d walidacji");
                }

                alert("Administrator zostaÅ‚ utworzony");
                window.location.href = "/view/users";

            } catch (err) {
                messageDiv.innerHTML = err.message;
            }
        });
    </script>

</div>
</html>